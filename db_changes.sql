ALTER TABLE `civicrm_contribution_recur` CHANGE COLUMN `frequency_unit` `frequency_unit` enum('day','weekly','bi-weekly','monthly','bi-monthly','quarterly','semiannually','yearly') CHARACTER SET utf8 COLLATE utf8_unicode_ci DEFAULT 'monthly' COMMENT 'Time units for recurrence of payment.';

DELETE FROM `civicrm_msg_template` WHERE id = 7;

INSERT INTO `civicrm_msg_template` (`id`, `msg_title`, `msg_subject`, `msg_text`, `msg_html`, `is_active`, `workflow_id`, `is_default`, `is_reserved`, `pdf_format_id`) VALUES ('7', 'Contributions - Receipt (on-line)', '{if $is_pay_later}{ts}Invoice{/ts}{else}{ts}Receipt{/ts}{/if} - {$title}', '{if $receipt_text}\r\n{$receipt_text}\r\n{/if}\r\n{if $is_pay_later}\r\n\r\n===========================================================\r\n{$pay_later_receipt}\r\n===========================================================\r\n{else}\r\n\r\n{ts}Please print this receipt for your records.{/ts}\r\n{/if}\r\n\r\n{if $amount}\r\n===========================================================\r\n{ts}Contribution Information{/ts}\r\n\r\n===========================================================\r\n{if $lineItem and $priceSetID and !$is_quick_config}\r\n{foreach from=$lineItem item=value key=priceset}\r\n---------------------------------------------------------\r\n{capture assign=ts_item}{ts}Item{/ts}{/capture}\r\n{capture assign=ts_qty}{ts}Qty{/ts}{/capture}\r\n{capture assign=ts_each}{ts}Each{/ts}{/capture}\r\n{capture assign=ts_total}{ts}Total{/ts}{/capture}\r\n{$ts_item|string_format:\"%-30s\"} {$ts_qty|string_format:\"%5s\"} {$ts_each|string_format:\"%10s\"} {$ts_total|string_format:\"%10s\"}\r\n----------------------------------------------------------\r\n{foreach from=$value item=line}\r\n{capture assign=ts_item}{if $line.html_type eq \'Text\'}{$line.label}{else}{$line.field_title} - {$line.label}{/if} {if $line.description} {$line.description}{/if}{/capture}{$ts_item|truncate:30:\"...\"|string_format:\"%-30s\"} {$line.qty|string_format:\"%5s\"} {$line.unit_price|crmMoney:$currency|string_format:\"%10s\"} {$line.line_total|crmMoney:$currency|string_format:\"%10s\"}\r\n{/foreach}\r\n{/foreach}\r\n\r\n{ts}Total Amount{/ts}: {$amount|crmMoney:$currency}\r\n{else}\r\n{ts}Amount{/ts}: {$amount|crmMoney:$currency} {if $amount_level } - {$amount_level} {/if}\r\n{/if}\r\n{/if}\r\n{if $receive_date}\r\n\r\n{ts}Date{/ts}: {$receive_date|crmDate}\r\n{/if}\r\n{if $is_monetary and $trxn_id}\r\n{ts}Transaction #{/ts}: {$trxn_id}\r\n{/if}\r\n\r\n{if $is_recur and ($contributeMode eq \'notify\' or $contributeMode eq \'directIPN\')}\r\n{ts}This is a recurring contribution. You can cancel future contributions at:{/ts}\r\n\r\n{$cancelSubscriptionUrl}\r\n\r\n{ts}You can update billing details for this recurring contribution at:{/ts}\r\n\r\n{$updateSubscriptionBillingUrl}\r\n\r\n{ts}You can update recurring contribution amount or change the number of installments for this recurring contribution at:{/ts}\r\n\r\n{$updateSubscriptionUrl}\r\n\r\n{/if}\r\n\r\n{if $honor_block_is_active }\r\n===========================================================\r\n{$honor_type}\r\n===========================================================\r\n{$honor_prefix} {$honor_first_name} {$honor_last_name}\r\n{if $honor_email}\r\n{ts}Honoree Email{/ts}: {$honor_email}\r\n{/if}\r\n\r\n{/if}\r\n{if $pcpBlock}\r\n===========================================================\r\n{ts}Personal Campaign Page{/ts}\r\n\r\n===========================================================\r\n{ts}Display In Honor Roll{/ts}: {if $pcp_display_in_roll}{ts}Yes{/ts}{else}{ts}No{/ts}{/if}\r\n\r\n{if $pcp_roll_nickname}{ts}Nick Name{/ts}: {$pcp_roll_nickname}{/if}\r\n\r\n{if $pcp_personal_note}{ts}Personal Note{/ts}: {$pcp_personal_note}{/if}\r\n\r\n{/if}\r\n{if $onBehalfProfile}\r\n===========================================================\r\n{ts}On Behalf Of{/ts}\r\n\r\n===========================================================\r\n{foreach from=$onBehalfProfile item=onBehalfValue key=onBehalfName}\r\n{$onBehalfName}: {$onBehalfValue}\r\n{/foreach}\r\n{/if}\r\n\r\n{if !( $contributeMode eq \'notify\' OR $contributeMode eq \'directIPN\' ) and $is_monetary}\r\n{if $is_pay_later}\r\n===========================================================\r\n{ts}Registered Email{/ts}\r\n\r\n===========================================================\r\n{$email}\r\n{elseif $amount GT 0}\r\n===========================================================\r\n{ts}Billing Name and Address{/ts}\r\n\r\n===========================================================\r\n{$billingName}\r\n{$address}\r\n\r\n{$email}\r\n{/if} {* End ! is_pay_later condition. *}\r\n{/if}\r\n{if $contributeMode eq \'direct\' AND !$is_pay_later AND $amount GT 0}\r\n\r\n===========================================================\r\n{if $payment_method eq \'ACH\'}\r\n{ts}Account Information{/ts}\r\n{else}\r\n{ts}Credit Card Information{/ts}\r\n{/if}\r\n\r\n===========================================================\r\n{if $payment_method eq \'ACH\'}\r\n{ts}Account Type:{/ts} {$account_type}\r\n{ts}Account Number:{/ts} {$account_number}\r\n{ts}Routing Number:{/ts} {$routing_number}\r\n{else}\r\n{$credit_card_type}\r\n{$credit_card_number}\r\n{ts}Expires{/ts}: {$credit_card_exp_date|truncate:7:\'\'|crmDate}\r\n{/if}\r\n{/if}\r\n\r\n{if $selectPremium }\r\n===========================================================\r\n{ts}Premium Information{/ts}\r\n\r\n===========================================================\r\n{$product_name}\r\n{if $option}\r\n{ts}Option{/ts}: {$option}\r\n{/if}\r\n{if $sku}\r\n{ts}SKU{/ts}: {$sku}\r\n{/if}\r\n{if $start_date}\r\n{ts}Start Date{/ts}: {$start_date|crmDate}\r\n{/if}\r\n{if $end_date}\r\n{ts}End Date{/ts}: {$end_date|crmDate}\r\n{/if}\r\n{if $contact_email OR $contact_phone}\r\n\r\n{ts}For information about this premium, contact:{/ts}\r\n\r\n{if $contact_email}\r\n  {$contact_email}\r\n{/if}\r\n{if $contact_phone}\r\n  {$contact_phone}\r\n{/if}\r\n{/if}\r\n{if $is_deductible AND $price}\r\n\r\n{ts 1=$price|crmMoney:$currency}The value of this premium is %1. This may affect the amount of the tax deduction you can claim. Consult your tax advisor for more information.{/ts}{/if}\r\n{/if}\r\n\r\n{if $customPre}\r\n===========================================================\r\n{$customPre_grouptitle}\r\n\r\n===========================================================\r\n{foreach from=$customPre item=customValue key=customName}\r\n{if ( $trackingFields and ! in_array( $customName, $trackingFields ) ) or ! $trackingFields}\r\n {$customName}: {$customValue}\r\n{/if}\r\n{/foreach}\r\n{/if}\r\n\r\n\r\n{if $customPost}\r\n===========================================================\r\n{$customPost_grouptitle}\r\n\r\n===========================================================\r\n{foreach from=$customPost item=customValue key=customName}\r\n{if ( $trackingFields and ! in_array( $customName, $trackingFields ) ) or ! $trackingFields}\r\n {$customName}: {$customValue}\r\n{/if}\r\n{/foreach}\r\n{/if}', '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\r\n <title></title>\r\n</head>\r\n<body>\r\n\r\n{capture assign=headerStyle}colspan=\"2\" style=\"text-align: left; padding: 4px; border-bottom: 1px solid #999; background-color: #eee;\"{/capture}\r\n{capture assign=labelStyle }style=\"padding: 4px; border-bottom: 1px solid #999; background-color: #f7f7f7;\"{/capture}\r\n{capture assign=valueStyle }style=\"padding: 4px; border-bottom: 1px solid #999;\"{/capture}\r\n\r\n<center>\r\n <table width=\"500\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" id=\"crm-event_receipt\" style=\"font-family: Arial, Verdana, sans-serif; text-align: left;\">\r\n\r\n  <!-- BEGIN HEADER -->\r\n  <!-- You can add table row(s) here with logo or other header elements -->\r\n  <!-- END HEADER -->\r\n\r\n  <!-- BEGIN CONTENT -->\r\n\r\n  <tr>\r\n   <td>\r\n\r\n    {if $receipt_text}\r\n     <p>{$receipt_text|htmlize}</p>\r\n    {/if}\r\n\r\n    {if $is_pay_later}\r\n     <p>{$pay_later_receipt}</p> {* FIXME: this might be text rather than HTML *}\r\n    {else}\r\n     <p>{ts}Please print this confirmation for your records.{/ts}</p>\r\n    {/if}\r\n\r\n   </td>\r\n  </tr>\r\n  </table>\r\n  <table width=\"500\" style=\"border: 1px solid #999; margin: 1em 0em 1em; border-collapse: collapse;\">\r\n\r\n     {if $amount}\r\n\r\n\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {ts}Contribution Information{/ts}\r\n       </th>\r\n      </tr>\r\n\r\n      {if $lineItem and $priceSetID and !$is_quick_config}\r\n\r\n       {foreach from=$lineItem item=value key=priceset}\r\n        <tr>\r\n         <td colspan=\"2\" {$valueStyle}>\r\n          <table> {* FIXME: style this table so that it looks like the text version (justification, etc.) *}\r\n           <tr>\r\n            <th>{ts}Item{/ts}</th>\r\n            <th>{ts}Qty{/ts}</th>\r\n            <th>{ts}Each{/ts}</th>\r\n            <th>{ts}Total{/ts}</th>\r\n           </tr>\r\n           {foreach from=$value item=line}\r\n            <tr>\r\n             <td>\r\n             {if $line.html_type eq \'Text\'}{$line.label}{else}{$line.field_title} - {$line.label}{/if} {if $line.description}<div>{$line.description|truncate:30:\"...\"}</div>{/if}\r\n             </td>\r\n             <td>\r\n              {$line.qty}\r\n             </td>\r\n             <td>\r\n              {$line.unit_price|crmMoney:$currency}\r\n             </td>\r\n             <td>\r\n              {$line.line_total|crmMoney:$currency}\r\n             </td>\r\n            </tr>\r\n           {/foreach}\r\n          </table>\r\n         </td>\r\n        </tr>\r\n       {/foreach}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}Total Amount{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$amount|crmMoney:$currency}\r\n        </td>\r\n       </tr>\r\n\r\n      {else}\r\n\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}Amount{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$amount|crmMoney:$currency} {if $amount_level} - {$amount_level}{/if}\r\n        </td>\r\n       </tr>\r\n\r\n      {/if}\r\n\r\n\r\n     {/if}\r\n\r\n\r\n     {if $receive_date}\r\n      <tr>\r\n       <td {$labelStyle}>\r\n        {ts}Date{/ts}\r\n       </td>\r\n       <td {$valueStyle}>\r\n        {$receive_date|crmDate}\r\n       </td>\r\n      </tr>\r\n     {/if}\r\n\r\n     {if $is_monetary and $trxn_id}\r\n      <tr>\r\n       <td {$labelStyle}>\r\n        {ts}Transaction #{/ts}\r\n       </td>\r\n       <td {$valueStyle}>\r\n        {$trxn_id}\r\n       </td>\r\n      </tr>\r\n     {/if}\r\n\r\n     {if $is_recur}\r\n      {if $contributeMode eq \'notify\' or $contributeMode eq \'directIPN\'}\r\n       <tr>\r\n        <td  colspan=\"2\" {$labelStyle}>\r\n         {ts 1=$cancelSubscriptionUrl}This is a recurring contribution. You can cancel future contributions by <a href=\"%1\">visiting this web page</a>.{/ts}\r\n        </td>\r\n       <tr>\r\n       </tr>\r\n        <td colspan=\"2\" {$labelStyle}>\r\n         {ts 1=$updateSubscriptionBillingUrl}You can update billing details for this recurring contribution by <a href=\"%1\">visiting this web page</a>.{/ts}\r\n        </td>\r\n       <tr>\r\n       </tr>\r\n        <td colspan=\"2\" {$labelStyle}>\r\n         {ts 1=$updateSubscriptionUrl}You can update recurring contribution amount or change the number of installments for this recurring contribution by <a href=\"%1\">visiting this web page</a>.{/ts}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n     {/if}\r\n\r\n     {if $honor_block_is_active}\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {$honor_type}\r\n       </th>\r\n      </tr>\r\n      <tr>\r\n       <td colspan=\"2\" {$labelStyle}>\r\n        {$honor_prefix} {$honor_first_name} {$honor_last_name}\r\n       </td>\r\n      </tr>\r\n      {if $honor_email}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}Honoree Email{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$honor_email}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n     {/if}\r\n\r\n     {if $pcpBlock}\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {ts}Personal Campaign Page{/ts}\r\n       </th>\r\n      </tr>\r\n      <tr>\r\n       <td {$labelStyle}>\r\n        {ts}Display In Honor Roll{/ts}\r\n       </td>\r\n       <td {$valueStyle}>\r\n        {if $pcp_display_in_roll}{ts}Yes{/ts}{else}{ts}No{/ts}{/if}\r\n       </td>\r\n      </tr>\r\n      {if $pcp_roll_nickname}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}Nick Name{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$pcp_roll_nickname}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n      {if $pcp_personal_note}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}Personal Note{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$pcp_personal_note}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n     {/if}\r\n\r\n     {if $onBehalfProfile}\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {$onBehalfProfile_grouptitle}\r\n       </th>\r\n      </tr>\r\n      {foreach from=$onBehalfProfile item=onBehalfValue key=onBehalfName}\r\n        <tr>\r\n         <td {$labelStyle}>\r\n          {$onBehalfName}\r\n         </td>\r\n         <td {$valueStyle}>\r\n          {$onBehalfValue}\r\n         </td>\r\n        </tr>\r\n      {/foreach}\r\n     {/if}\r\n\r\n     {if $isShare}\r\n      <tr>\r\n        <td colspan=\"2\" {$valueStyle}>\r\n            {capture assign=contributionUrl}{crmURL p=\'civicrm/contribute/transact\' q=\"reset=1&id=`$contributionPageId`\" a=true fe=1 h=1}{/capture}\r\n            {include file=\"CRM/common/SocialNetwork.tpl\" emailMode=true url=$contributionUrl title=$title pageURL=$contributionUrl}\r\n        </td>\r\n      </tr>\r\n     {/if}\r\n\r\n     {if ! ($contributeMode eq \'notify\' OR $contributeMode eq \'directIPN\') and $is_monetary}\r\n      {if $is_pay_later}\r\n       <tr>\r\n        <th {$headerStyle}>\r\n         {ts}Registered Email{/ts}\r\n        </th>\r\n       </tr>\r\n       <tr>\r\n        <td colspan=\"2\" {$valueStyle}>\r\n         {$email}\r\n        </td>\r\n       </tr>\r\n      {elseif $amount GT 0}\r\n       <tr>\r\n        <th {$headerStyle}>\r\n         {ts}Billing Name and Address{/ts}\r\n        </th>\r\n       </tr>\r\n       <tr>\r\n        <td colspan=\"2\" {$valueStyle}>\r\n         {$billingName}<br />\r\n         {$address|nl2br}<br />\r\n         {$email}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n     {/if}\r\n\r\n     {if $contributeMode eq \'direct\' AND !$is_pay_later AND $amount GT 0}\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {if $payment_method eq \'ACH\'}\r\n          {ts}Account Information{/ts}\r\n        {else}\r\n          {ts}Credit Card Information{/ts}\r\n        {/if}\r\n       </th>\r\n      </tr>\r\n      <tr>\r\n       <td colspan=\"2\" {$valueStyle}>\r\n        {if $payment_method eq \'ACH\'}\r\n        {ts}Account Type:{/ts} {$account_type}<br />\r\n        {ts}Account Number:{/ts} {$account_number}<br />\r\n        {ts}Routing Number:{/ts} {$routing_number}<br />\r\n        {else}\r\n        {$credit_card_type}<br />\r\n        {$credit_card_number}<br />\r\n        {ts}Expires{/ts}: {$credit_card_exp_date|truncate:7:\'\'|crmDate}<br />\r\n        {/if}\r\n       </td>\r\n      </tr>\r\n     {/if}\r\n\r\n     {if $selectPremium}\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {ts}Premium Information{/ts}\r\n       </th>\r\n      </tr>\r\n      <tr>\r\n       <td colspan=\"2\" {$labelStyle}>\r\n        {$product_name}\r\n       </td>\r\n      </tr>\r\n      {if $option}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}Option{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$option}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n      {if $sku}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}SKU{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$sku}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n      {if $start_date}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}Start Date{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$start_date|crmDate}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n      {if $end_date}\r\n       <tr>\r\n        <td {$labelStyle}>\r\n         {ts}End Date{/ts}\r\n        </td>\r\n        <td {$valueStyle}>\r\n         {$end_date|crmDate}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n      {if $contact_email OR $contact_phone}\r\n       <tr>\r\n        <td colspan=\"2\" {$valueStyle}>\r\n         <p>{ts}For information about this premium, contact:{/ts}</p>\r\n         {if $contact_email}\r\n          <p>{$contact_email}</p>\r\n         {/if}\r\n         {if $contact_phone}\r\n          <p>{$contact_phone}</p>\r\n         {/if}\r\n        </td>\r\n       </tr>\r\n      {/if}\r\n      {if $is_deductible AND $price}\r\n        <tr>\r\n         <td colspan=\"2\" {$valueStyle}>\r\n          <p>{ts 1=$price|crmMoney:$currency}The value of this premium is %1. This may affect the amount of the tax deduction you can claim. Consult your tax advisor for more information.{/ts}</p>\r\n         </td>\r\n        </tr>\r\n      {/if}\r\n     {/if}\r\n\r\n     {if $customPre}\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {$customPre_grouptitle}\r\n       </th>\r\n      </tr>\r\n      {foreach from=$customPre item=customValue key=customName}\r\n       {if ($trackingFields and ! in_array($customName, $trackingFields)) or ! $trackingFields}\r\n        <tr>\r\n         <td {$labelStyle}>\r\n          {$customName}\r\n         </td>\r\n         <td {$valueStyle}>\r\n          {$customValue}\r\n         </td>\r\n        </tr>\r\n       {/if}\r\n      {/foreach}\r\n     {/if}\r\n\r\n     {if $customPost}\r\n      <tr>\r\n       <th {$headerStyle}>\r\n        {$customPost_grouptitle}\r\n       </th>\r\n      </tr>\r\n      {foreach from=$customPost item=customValue key=customName}\r\n       {if ($trackingFields and ! in_array($customName, $trackingFields)) or ! $trackingFields}\r\n        <tr>\r\n         <td {$labelStyle}>\r\n          {$customName}\r\n         </td>\r\n         <td {$valueStyle}>\r\n          {$customValue}\r\n         </td>\r\n        </tr>\r\n       {/if}\r\n      {/foreach}\r\n     {/if}\r\n\r\n  </table>\r\n</center>\r\n\r\n</body>\r\n</html>', '1', '656', '1', '0', null);